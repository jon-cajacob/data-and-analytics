"use strict";(self.webpackChunkdata_and_analytics=self.webpackChunkdata_and_analytics||[]).push([[4065],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=p(a),u=r,h=d["".concat(s,".").concat(u)]||d[u]||c[u]||o;return a?n.createElement(h,i(i({ref:t},m),{},{components:a})):n.createElement(h,i({ref:t},m))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},74352:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const o={sidebar_position:999,title:"3.4 | Preparing the product dimension (dimProduct)",slug:"/3.4",tags:["3 | Preparing the data"]},i="3.4 | Preparing the product dimension (*dimProduct*)",l={unversionedId:"book/chapter3/03-04-prepare-2",id:"book/chapter3/03-04-prepare-2",title:"3.4 | Preparing the product dimension (dimProduct)",description:"In this chapter we continue with preparing the product dimension dimProduct. For this table, some transformation steps are the same as for dimCustomer (in general you will notice over time that there is a certain set of transformations that is relevant for almost all data tables). Some transformation steps are new and will broaden your understanding of Power Query.",source:"@site/docs/01-book/01-chapter3/03-04-prepare-2.md",sourceDirName:"01-book/01-chapter3",slug:"/3.4",permalink:"/3.4",draft:!1,tags:[{label:"3 | Preparing the data",permalink:"/tags/3-preparing-the-data"}],version:"current",sidebarPosition:999,frontMatter:{sidebar_position:999,title:"3.4 | Preparing the product dimension (dimProduct)",slug:"/3.4",tags:["3 | Preparing the data"]},sidebar:"tutorialSidebar",previous:{title:"3.3 | Preparing the customer dimension (dimCustomer)",permalink:"/3.3"},next:{title:"3.5 | Preparing the sales channel dimension (dimSalesChannel)",permalink:"/3.5"}},s={},p=[{value:"1. Inspect the (raw) data table",id:"1-inspect-the-raw-data-table",level:4},{value:"2. Select the columns needed",id:"2-select-the-columns-needed",level:4},{value:"3. Check and adjust the data types",id:"3-check-and-adjust-the-data-types",level:4},{value:"4. Combine <em>Product ID</em> and <em>Product Desc</em> in a new custom calculated column",id:"4-combine-product-id-and-product-desc-in-a-new-custom-calculated-column",level:4},{value:"5. Join (merge) the table <em>helperProductCategory</em>",id:"5-join-merge-the-table-helperproductcategory",level:4},{value:"6. Disable loading the mapping table <em>helperProductCategory</em>",id:"6-disable-loading-the-mapping-table-helperproductcategory",level:4},{value:"7. Create a small mapping table <em>helperProductType</em> by manual input and join it with <em>dimProduct</em>",id:"7-create-a-small-mapping-table-helperproducttype-by-manual-input-and-join-it-with-dimproduct",level:4},{value:"8. Remove the column _xlPROD_TYPE",id:"8-remove-the-column-_xlprod_type",level:4},{value:"9. Remove duplicates from column <em>Product ID</em>",id:"9-remove-duplicates-from-column-product-id",level:4}],m={toc:p};function d(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"34--preparing-the-product-dimension-dimproduct"},"3.4 | Preparing the product dimension (",(0,r.kt)("em",{parentName:"h1"},"dimProduct"),")"),(0,r.kt)("p",null,"In this chapter we continue with preparing the product dimension ",(0,r.kt)("em",{parentName:"p"},"dimProduct"),". For this table, some transformation steps are the same as for dimCustomer (in general you will notice over time that there is a certain set of transformations that is relevant for almost all data tables). Some transformation steps are new and will broaden your understanding of Power Query."),(0,r.kt)("h4",{id:"1-inspect-the-raw-data-table"},"1. Inspect the (raw) data table"),(0,r.kt)("p",null,"As for dimCustomer, we first want to inspect the table to understand the transformations we need to apply. Here again, Power Query automatically applied some basic steps like promoting the headers and changing column data types."),(0,r.kt)("p",null,"Unlike in dimCustomer, column headers are correctly set from the start (because in the underlying excel the column headers are in the first row). Before setting the data type for each column, let's select only the columns which we actually need for the analysis."),(0,r.kt)("h4",{id:"2-select-the-columns-needed"},"2. Select the columns needed"),(0,r.kt)("p",null,"Select the transformation step ",(0,r.kt)("em",{parentName:"p"},"Promoted Headers")," and follow ",(0,r.kt)("em",{parentName:"p"},"Home \u2192 Choose Columns")," to select the columns needed."),(0,r.kt)("p",null,"When you do that, Power Query asks you to confirm inserting a transformation step between two existing ones. Confirm that with ",(0,r.kt)("em",{parentName:"p"},"Insert"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-20",src:a(46559).Z,width:"1299",height:"266"})),(0,r.kt)("p",null,"For the upcoming transformation steps we only need the following columns:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-19",src:a(10314).Z,width:"1323",height:"875"})),(0,r.kt)("h4",{id:"3-check-and-adjust-the-data-types"},"3. Check and adjust the data types"),(0,r.kt)("p",null,"Select the transformation step ",(0,r.kt)("em",{parentName:"p"},"Changed Type")," in order to inspect the data types that Power Query has automatically set."),(0,r.kt)("p",null,"Immediately, we encounter an error:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-21",src:a(11557).Z,width:"1318",height:"538"})),(0,r.kt)("p",null,"This error occurs because in the transformation step ",(0,r.kt)("em",{parentName:"p"},"Changed Type"),", which Power Query automatically created when connecting the Excel, the code refers to columns which we actually removed in the precedent step ",(0,r.kt)("em",{parentName:"p"},"Removed Other Columns"),". Because Power Query cannot find these removed columns anymore, e.g. the column ",(0,r.kt)("em",{parentName:"p"},"_xCALC1"),", it gives us back an error."),(0,r.kt)("p",null,"The simplest way to remediate this error is to delete the step ",(0,r.kt)("em",{parentName:"p"},"Changed Type")," and create a new one with simply setting the data type for the selected columns. As for dimCustomer, we neither have a date column nor columns holding numerical information with which we want to perform calculations. Therefore, define all columns to be the data type ",(0,r.kt)("em",{parentName:"p"},"text"),"."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The transformation steps ",(0,r.kt)("em",{parentName:"p"},"Promoted Headers"),", ",(0,r.kt)("em",{parentName:"p"},"Removed Other Columns")," and ",(0,r.kt)("em",{parentName:"p"},"Changed Type")," are pretty much always used and applied to all queries in Power Query, usually as the first few transformation steps for a data table.")),(0,r.kt)("h4",{id:"4-combine-product-id-and-product-desc-in-a-new-custom-calculated-column"},"4. Combine ",(0,r.kt)("em",{parentName:"h4"},"Product ID")," and ",(0,r.kt)("em",{parentName:"h4"},"Product Desc")," in a new custom calculated column"),(0,r.kt)("p",null,"As for dimCustomer, we want to create a new column which combines the ID and description of each product which is very useful later on when a user searches for a product by its description or ID."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Add Column \u2192 Custom Column")),(0,r.kt)("p",null,"In the appearing window, name the new column ",(0,r.kt)("em",{parentName:"p"},"Product")," and enter the following code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="New calculated column: Customer"',title:'"New',calculated:!0,"column:":!0,'Customer"':!0},'[Product Desc] & " (" & [Product ID] & ")"\n')),(0,r.kt)("p",null,"And in a next step, change the data type of the newly added column to ",(0,r.kt)("em",{parentName:"p"},"text"),"."),(0,r.kt)("p",null,"After doing these steps, your Power Query should look like the following:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-22",src:a(25180).Z,width:"1322",height:"728"})),(0,r.kt)("h4",{id:"5-join-merge-the-table-helperproductcategory"},"5. Join (merge) the table ",(0,r.kt)("em",{parentName:"h4"},"helperProductCategory")),(0,r.kt)("p",null,"In the next step, we want to combine two tables with a table join. In Power Query, joins are called ",(0,r.kt)("em",{parentName:"p"},"merges"),". One way to think about or understand a table join is to compare with a lookup in an Excel spreadsheet. Essentially, we are looking for matching members in the other (mapping) table and retrieve information from there based on a shared key (usually an ID)."),(0,r.kt)("p",null,"In our ",(0,r.kt)("em",{parentName:"p"},"dimProduct")," table we see there is a column ",(0,r.kt)("em",{parentName:"p"},"Subcategory ID"),". Navigating to the table ",(0,r.kt)("em",{parentName:"p"},"helperProductCategory"),", we can see there is also a column ",(0,r.kt)("em",{parentName:"p"},"Subcategory ID")," and some additional namings for the product subcategories and categories. The goal is to map these subcategories and categories to our ",(0,r.kt)("em",{parentName:"p"},"dimProduct")," table."),(0,r.kt)("p",null,"Before we combine the two tables, let's make sure the mapping table ",(0,r.kt)("em",{parentName:"p"},"helperProductCategory")," is in a good shape. For that, navigate to helperProductCategory in the navigation on the left side of the Power Query interface."),(0,r.kt)("p",null,"Make sure the following steps are applied to the mapping table:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Select only the columns ",(0,r.kt)("em",{parentName:"li"},"Subcategory ID"),", ",(0,r.kt)("em",{parentName:"li"},"Subcategory"),", ",(0,r.kt)("em",{parentName:"li"},"Category")),(0,r.kt)("li",{parentName:"ul"},"Change the data type to text for all selected columns"),(0,r.kt)("li",{parentName:"ul"},"Remove duplicates from the column Subcategory ID (note, this is more for safety reasons as there are currently no duplicates, but maybe if the data source changes in the future we want to make sure there are never duplicates in this mapping table)")),(0,r.kt)("p",null,"Power Query should look like this for ",(0,r.kt)("em",{parentName:"p"},"helperProductCategory"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-24",src:a(22864).Z,width:"1321",height:"619"})),(0,r.kt)("p",null,"Now we can navigate back to ",(0,r.kt)("em",{parentName:"p"},"dimProduct")," and perform the table join."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Home \u2192 Merge Queries")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-23",src:a(57932).Z,width:"1320",height:"698"})),(0,r.kt)("p",null,"In the appearing window, select ",(0,r.kt)("em",{parentName:"p"},"helperProductCategory")," as the second table (the table on the right of the join). Then, select in both tables the columns ",(0,r.kt)("em",{parentName:"p"},"Subcategory ID")," (they should be grey as in the screenshot). Leave the join type on 'Left Outer (...)' and confirm with ",(0,r.kt)("em",{parentName:"p"},"OK"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-25",src:a(56156).Z,width:"1304",height:"717"})),(0,r.kt)("p",null,"A new step ",(0,r.kt)("em",{parentName:"p"},"Merged Queries")," should have appeard in ",(0,r.kt)("em",{parentName:"p"},"APPLIED STEPS"),". From here, we have to select which columns of ",(0,r.kt)("em",{parentName:"p"},"helperProductCategory")," we want to actually add to ",(0,r.kt)("em",{parentName:"p"},"dimProduct"),"."),(0,r.kt)("p",null,"In the newly added column, click on the symbol at the right end of the column header. Select the columns you want to add (plus, de-select the option about original column name prefixes) and confirm with OK."),(0,r.kt)("p",null,"Note, we de-selected ",(0,r.kt)("em",{parentName:"p"},"Subcategory ID")," because this information already exists as a column in ",(0,r.kt)("em",{parentName:"p"},"dimProduct"),"."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-26",src:a(53827).Z,width:"1318",height:"718"})),(0,r.kt)("p",null,"Your Power Query should like this now:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-27",src:a(42414).Z,width:"1319",height:"760"})),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Before combining any two tables, make sure there are no duplicates in the column containing the mapping key in the mapping table. If there are duplicates, data is multiplied upon joining the two tables resulting in duplicated rows in the combined table.")),(0,r.kt)("h4",{id:"6-disable-loading-the-mapping-table-helperproductcategory"},"6. Disable loading the mapping table ",(0,r.kt)("em",{parentName:"h4"},"helperProductCategory")),(0,r.kt)("p",null,"In the previous step we used the table ",(0,r.kt)("em",{parentName:"p"},"helperProductCategory")," to map product subcategory and category information to ",(0,r.kt)("em",{parentName:"p"},"dimProduct"),". It functions as a supporting table and as such we do not need to load it to the final data model."),(0,r.kt)("p",null,"To disable loading this table, do a right-click on the table and click on ",(0,r.kt)("em",{parentName:"p"},"Enable Load"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-28",src:a(95750).Z,width:"1321",height:"714"})),(0,r.kt)("p",null,"After disabling loading the table, its label should be appear in italic font."),(0,r.kt)("h4",{id:"7-create-a-small-mapping-table-helperproducttype-by-manual-input-and-join-it-with-dimproduct"},"7. Create a small mapping table ",(0,r.kt)("em",{parentName:"h4"},"helperProductType")," by manual input and join it with ",(0,r.kt)("em",{parentName:"h4"},"dimProduct")),(0,r.kt)("p",null,"In our dimProduct table we can see there is a column with a rather technical label ",(0,r.kt)("em",{parentName:"p"},"_xPROD_TYPE")," that contains some abbreviations. There are two distinct abbreviations, ",(0,r.kt)("em",{parentName:"p"},"xl_TRAD")," and ",(0,r.kt)("em",{parentName:"p"},"xl_MANUF"),". The provider of the data source tells us that the former stands for trade products and the latter for manufactured products. Because we do not want present such technical terms or abbreviations in any dashboard, let's replace these abbreviations with more speaking names."),(0,r.kt)("p",null,"One way to do this would be by replacing values, however this operation we already saw for ",(0,r.kt)("em",{parentName:"p"},"dimCustomer")," and hence here I want to show another way: creating a small mapping table to be joined with dimProduct."),(0,r.kt)("p",null,"First, create the small table mapping the abbreviations to speaking names and call it ",(0,r.kt)("em",{parentName:"p"},"helperProductType"),". For that, click on ",(0,r.kt)("em",{parentName:"p"},"Enter Data")," under ",(0,r.kt)("em",{parentName:"p"},"Home")," and a window appears that allows us to manually enter values into a table:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-29",src:a(68105).Z,width:"1322",height:"872"})),(0,r.kt)("p",null,"Confirm with ",(0,r.kt)("em",{parentName:"p"},"OK")," and a new table shows up under ",(0,r.kt)("em",{parentName:"p"},"Queries")," on the left. Navigate to the table and confirm it looks as intendend. Then, as in the previous step, disable loading the table."),(0,r.kt)("p",null,"Navigate back to ",(0,r.kt)("em",{parentName:"p"},"dimProduct")," and perform the table join as follows:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-30",src:a(10834).Z,width:"1309",height:"712"})),(0,r.kt)("p",null,"Then, expand the new column ",(0,r.kt)("em",{parentName:"p"},"ProductType")," in ",(0,r.kt)("em",{parentName:"p"},"dimProduct"),"."),(0,r.kt)("p",null,"The table ",(0,r.kt)("em",{parentName:"p"},"dimProduct")," should now like the following:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-31",src:a(30045).Z,width:"1322",height:"698"})),(0,r.kt)("h4",{id:"8-remove-the-column-_xlprod_type"},"8. Remove the column _xlPROD_TYPE"),(0,r.kt)("p",null,"We do not need the product type abbreviations anymore so let's remove the column:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"03-32",src:a(60368).Z,width:"1327",height:"788"})),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Alternatively, simply select the columns you want to remove and press the ",(0,r.kt)("strong",{parentName:"p"},"delete key")," on your keyboard.")),(0,r.kt)("h4",{id:"9-remove-duplicates-from-column-product-id"},"9. Remove duplicates from column ",(0,r.kt)("em",{parentName:"h4"},"Product ID")),(0,r.kt)("p",null,"Currently, there are no duplicates in ",(0,r.kt)("em",{parentName:"p"},"Product ID"),". However, we want to avoid problems in the future in case duplicates suddenly show up in the source data. Because ",(0,r.kt)("em",{parentName:"p"},"dimProduct")," is a dimension table and we will later use ",(0,r.kt)("em",{parentName:"p"},"Product ID")," as the key to connect with the fact data, there would be an error on refreshing the dataset in case of duplicate entries in ",(0,r.kt)("em",{parentName:"p"},"Product ID"),". So this last step is a ",(0,r.kt)("strong",{parentName:"p"},"safety measure to increase the robustness")," of the data model."))}d.isMDXComponent=!0},10314:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-19-03435a2e32db624c5f34ba83bca9a7ef.png"},46559:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-20-0bd61e3cd980a55191822c49f568e306.png"},11557:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-21-7dcf7f259a95f5208ff82fff0f906d8d.png"},25180:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-22-86bbdac2b87ef8e88957a336a21ab5a3.png"},57932:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-23-465978f498b46708d63d2a24821d6568.png"},22864:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-24-2959aaf786092440ab03648597774d7b.png"},56156:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-25-45d465a2a4857db898154ffc52dd369f.png"},53827:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-26-2baa07381cb759cdbb3e0b4acfd8f69e.png"},42414:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-27-ae1e03cf8ea8c8d680ba003eedb084f4.png"},95750:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-28-8b16b4a210e973a0c1ecfa1ad7a190c7.png"},68105:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-29-0061fedeede5f6c121dd2d2e157f5870.png"},10834:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-30-043a93ca1701c9f832a7b6843cdeb8a9.png"},30045:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-31-f0e45065edf4530823cb3264aab4663d.png"},60368:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/img_book_03-32-e851ec807267ff8e35b5db1542355f89.png"}}]);