"use strict";(self.webpackChunkdata_and_analytics=self.webpackChunkdata_and_analytics||[]).push([[3985],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>u});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),c=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(a),h=n,u=d["".concat(s,".").concat(h)]||d[h]||m[h]||i;return a?r.createElement(u,o(o({ref:t},p),{},{components:a})):r.createElement(u,o({ref:t},p))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:n,o[1]=l;for(var c=2;c<i;c++)o[c]=a[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}h.displayName="MDXCreateElement"},30556:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=a(87462),n=(a(67294),a(3905));const i={sidebar_position:6,title:"6.6 | Row Level Security (RLS) implementation",slug:"/6.6",tags:["Row Level Security","Access Permissions","Security"]},o="6.6 | Row Level Security (RLS) implementation",l={unversionedId:"book/chapter6/06-06-rls",id:"book/chapter6/06-06-rls",title:"6.6 | Row Level Security (RLS) implementation",description:"6.6.1 | Introduction",source:"@site/docs/01-book/01-chapter6/06-06-rls.md",sourceDirName:"01-book/01-chapter6",slug:"/6.6",permalink:"/6.6",draft:!1,tags:[{label:"Row Level Security",permalink:"/tags/row-level-security"},{label:"Access Permissions",permalink:"/tags/access-permissions"},{label:"Security",permalink:"/tags/security"}],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,title:"6.6 | Row Level Security (RLS) implementation",slug:"/6.6",tags:["Row Level Security","Access Permissions","Security"]},sidebar:"tutorialSidebar",previous:{title:"6.5 | Data security - How access permissions are implemented",permalink:"/6.5"},next:{title:"6.7 | Dataflows",permalink:"/6.7"}},s={},c=[{value:"6.6.1 | Introduction",id:"661--introduction",level:2},{value:"6.6.2 | Example",id:"662--example",level:2},{value:"1. In the Report Builder, via <em>Modeling</em> \u2192 <em>Security</em> \u2192 <em>Manage roles</em>, open the RLS role manager",id:"1-in-the-report-builder-via-modeling--security--manage-roles-open-the-rls-role-manager",level:4},{value:"2. Create a new RLS role with a bit of DAX",id:"2-create-a-new-rls-role-with-a-bit-of-dax",level:4},{value:"3. Testing the newly created RLS role",id:"3-testing-the-newly-created-rls-role",level:4},{value:"4. Adding users to RLS roles in the Power BI Service",id:"4-adding-users-to-rls-roles-in-the-power-bi-service",level:4},{value:"Bonus: A more simple but static way of RLS",id:"bonus-a-more-simple-but-static-way-of-rls",level:4},{value:"Download the PBIX with the RLS example",id:"download-the-pbix-with-the-rls-example",level:4},{value:"6.6.3 | Multiple RLS roles",id:"663--multiple-rls-roles",level:2}],p={toc:c};function d(e){let{components:t,...i}=e;return(0,n.kt)("wrapper",(0,r.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"66--row-level-security-rls-implementation"},"6.6 | Row Level Security (RLS) implementation"),(0,n.kt)("h2",{id:"661--introduction"},"6.6.1 | Introduction"),(0,n.kt)("p",null,"With a Row Level Security (RLS) mechanism we want to define which user can see which rows in our data model. Essentially, we are evaluation who is currently looking at a report and based on that we limit the rows that are returned an visualized on the report canvas. Please note the difference to previously discussed access permissions and roles on Workspaces, Semantic Models and Reports where we define who can see which object in the Power BI Service."),(0,n.kt)("p",null,"Usually, RLS is defined based on some ",(0,n.kt)("strong",{parentName:"p"},"organizational dimension"),", like for example business unit, legal entity, profit or cost center or based on a regional structure. As a prerequisite, the relevant organizational dimension of course has to be part of the data model."),(0,n.kt)("p",null,"Understanding how the implementation of RLS in Power BI specifically works is best achieved with looking at an example."),(0,n.kt)("h2",{id:"662--example"},"6.6.2 | Example"),(0,n.kt)("p",null,"Let's assume a very simple data model which has a dimension table ",(0,n.kt)("em",{parentName:"p"},"dimProfitCenter")," that filters sales data ",(0,n.kt)("em",{parentName:"p"},"factSales"),". Who can see which profit center is defined in a column AccessPermissions, please refer to the following screenshot to see how the example data model looks like:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"03-154",src:a(36519).Z,width:"1315",height:"820"})),(0,n.kt)("p",null,"To define and activate RLS in this model, we do the following:"),(0,n.kt)("h4",{id:"1-in-the-report-builder-via-modeling--security--manage-roles-open-the-rls-role-manager"},"1. In the Report Builder, via ",(0,n.kt)("em",{parentName:"h4"},"Modeling")," \u2192 ",(0,n.kt)("em",{parentName:"h4"},"Security")," \u2192 ",(0,n.kt)("em",{parentName:"h4"},"Manage roles"),", open the RLS role manager"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"03-155",src:a(50964).Z,width:"1321",height:"329"})),(0,n.kt)("h4",{id:"2-create-a-new-rls-role-with-a-bit-of-dax"},"2. Create a new RLS role with a bit of DAX"),(0,n.kt)("p",null,"Well name the new role ",(0,n.kt)("em",{parentName:"p"},"RLS_ProfitCenter")," and then navigate to the table ",(0,n.kt)("em",{parentName:"p"},"dimProfitCenter")," and enter the following small DAX code snippet (note, you may have to switch to the DAX editor with the button top right):"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="RLS rule"',title:'"RLS','rule"':!0},"CONTAINSSTRING([AccessPermissions], USERPRINCIPALNAME())\n")),(0,n.kt)("p",null,"Then we confirm with ",(0,n.kt)("em",{parentName:"p"},"Save"),"."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"03-156",src:a(38002).Z,width:"1307",height:"604"})),(0,n.kt)("p",null,"The DAX code we used evaluates the column ",(0,n.kt)("em",{parentName:"p"},"AccessPermissions")," if it can find the e-mail address of the user currently looking at the report. The function USERPRINCIPALNAME() returns that e-mail address. If the code finds the e-mail address, it returns ",(0,n.kt)("em",{parentName:"p"},"True"),". For all rows where this condition is ",(0,n.kt)("em",{parentName:"p"},"True"),", data is returned. And because ",(0,n.kt)("em",{parentName:"p"},"dimProfitCenter")," filters ",(0,n.kt)("em",{parentName:"p"},"factSales"),", this is also true for ",(0,n.kt)("em",{parentName:"p"},"factSales"),"."),(0,n.kt)("h4",{id:"3-testing-the-newly-created-rls-role"},"3. Testing the newly created RLS role"),(0,n.kt)("p",null,"Testing and making sure our RLS mechanism works as intended is important so Power BI has a functionality to exactly do that."),(0,n.kt)("p",null,"Via ",(0,n.kt)("em",{parentName:"p"},"Modeling")," \u2192 ",(0,n.kt)("em",{parentName:"p"},"Security")," \u2192 ",(0,n.kt)("em",{parentName:"p"},"View")," as we can look at the report from a specific role's (and user's) perspective."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"03-157",src:a(47282).Z,width:"1322",height:"881"})),(0,n.kt)("p",null,"After confirming, the report is filtered according to the rules of the RLS role:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"03-158",src:a(18522).Z,width:"1327",height:"558"})),(0,n.kt)("p",null,"Please note, the e-mail address seen on the canvas is based on a simple DAX Measure with the following code:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="USERPRINCIPALNAME() Measure"',title:'"USERPRINCIPALNAME()','Measure"':!0},"User = USERPRINCIPALNAME()\n")),(0,n.kt)("h4",{id:"4-adding-users-to-rls-roles-in-the-power-bi-service"},"4. Adding users to RLS roles in the Power BI Service"),(0,n.kt)("p",null,"After publishing our Semantic Model and Report with the RLS mechanism, we have to add users to the created RLS roles. Before that, users cannot see any data."),(0,n.kt)("p",null,"To do that, we navigate to the Workspace and then click on the three dots of the Semantic Model and select ",(0,n.kt)("em",{parentName:"p"},"Security"),":"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"03-159",src:a(5613).Z,width:"1315",height:"882"})),(0,n.kt)("p",null,"In the window, select the RLS role and add the respective users. Confirm with ",(0,n.kt)("em",{parentName:"p"},"Save"),":"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"03-160",src:a(73142).Z,width:"1324",height:"790"})),(0,n.kt)("p",null,"Please note, we can also work with Security Groups here, which are created and managed in the Microsoft Admin Center."),(0,n.kt)("h4",{id:"bonus-a-more-simple-but-static-way-of-rls"},"Bonus: A more simple but static way of RLS"),(0,n.kt)("p",null,"To understand the RLS role manager a bit more, let's have a look at another way of defining a RLS role. Instead of using a DAX function that dynamically evaluates a column, we can just simply fix the data scope for a specific role, see the following example:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"03-161",src:a(1544).Z,width:"1312",height:"599"})),(0,n.kt)("p",null,"All users that are part of the role ",(0,n.kt)("em",{parentName:"p"},"RLS_Simple"),", will only see the profit centers with ID 8 and 11."),(0,n.kt)("h4",{id:"download-the-pbix-with-the-rls-example"},"Download the PBIX with the RLS example"),(0,n.kt)("p",null,"The PBIX with the just introduced example can be downloaded from my repository here: ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/jon-cajacob/bi-with-power-bi"},(0,n.kt)("ins",null,"File repository on GitHub"))),(0,n.kt)("h2",{id:"663--multiple-rls-roles"},"6.6.3 | Multiple RLS roles"),(0,n.kt)("p",null,"Finally, please note that when a user is part of multiple RLS roles, the filter conditions of all roles are connected with an OR-condition. That means if for example one role permitts to see the country Switzerland and another role France, that user will see both countries in the reports."),(0,n.kt)("p",null,'Keep in mind that this may lead to "strange" totals in reports for that user. There are ways to deal with that with DAX Measures, however that exceeds the scope of this book quite a bit.'))}d.isMDXComponent=!0},36519:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/img_book_03-154-f4a7a24db5f3bf55d02ad129b26d0f7a.png"},50964:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/img_book_03-155-51a76c5a0237760f79ffa382e1a2b1a8.png"},38002:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/img_book_03-156-c72fc4f5d87697e6efa60378442021cc.png"},47282:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/img_book_03-157-b851e792315261972fbc795d65e22bc1.png"},18522:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/img_book_03-158-3a3048babfd7fd979180d27fbdca0903.png"},5613:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/img_book_03-159-a3ab9af2c4621a29b4d7302cc2f688de.png"},73142:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/img_book_03-160-50644e2bd73865ec11cc999f4ce5ea8b.png"},1544:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/img_book_03-161-39ba4ac3f075aa69fbf65fe512c55068.png"}}]);